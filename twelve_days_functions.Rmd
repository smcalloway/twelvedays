---
title: "Lab: The 12 Days of Christmas"
output:
  prettydoc::html_pretty:
    theme: tactile
    highlight: github
    css: styles.css
---

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 10px;}
</style>
<div class = "blue">

Nice work! You have no revisions!
  
**Score** (out of 7 questions): 3.714

</div>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Packages for Functions
library(dplyr)
library(glue)
library(stringr)
library(purrr)
library(english)
```


```{r, include = FALSE}
xmas <- read.csv("https://www.dropbox.com/s/e584pryn8evm1gz/xmas.csv?dl=1")

```

---

## Step One:  Plurals

```{r}

pluralize_gift <- function(gift){
  
  if(str_detect(gift, "y")){
    gift <- str_replace(gift, "y", "ies")
  } else if(str_detect(gift, "oo")){
    gift <- str_replace(gift, "oo", "ee")
  } else {
    gift <- str_c(gift, "s")
  }

return(gift)

}


<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 10px;}
</style>
<div class = "blue">
  
**3** -- What if the gift has a "y" not at the end? This function will replace the first "y" with an "ies". 

</div>

```

### Test pluralize_gift() Function

```{r}

purrr::map_chr(xmas$Gift.Item, pluralize_gift)

```


<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 10px;}
</style>
<div class = "blue">

**4** -- Nice work noticing that your function needs to be iterated! 

</div>


---

## Step Two: Creating sentences

```{r}
make_phrase <- function(num, num_word, item, verb, adjective, location) {
  
  verb <- str_replace_na(verb, "")
  adjective <- str_replace_na(adjective, "")
  location <- str_replace_na(location, "")
  
  vowel_start <- str_sub(item, 1, 1) %>% 
    str_detect("([aeiou])")
  
  if (num > 1) {
    
    item <- pluralize_gift(item)
    
  } else if (vowel_start) {
      item <- str_c("an ", item)

  } else {
    item <- str_c("a ", item)
    
  }
  
  glue::glue("{num_word} {adjective} {item} {verb} {location}") %>%
    str_squish()
  
}
```

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 10px;}
</style>
<div class = "blue">

**3** -- This will print "one a partridge" rather than "a partridge" or "one partridge"! 

</div>



### Test make_phrase() Function

```{r}
xmas <- xmas %>%
  mutate(day.num = as.character(as.english(Day)), 
    Full.Phrase = pmap_chr(list(num = Day, 
                                num_word = day.num, 
                                item = Gift.Item, 
                                verb = Verb, 
                                adjective = Adjective, 
                                location = Location), 
                           make_phrase)
  )

```

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 10px;}
</style>
<div class = "blue">

**4** -- Nice check! 

</div>



---


## Step Three:  Iteration.

```{r}

sing_line <- function(dataset, line, phrase_col){
  

  num_word <- as.character(ordinal(line))
  
  intro <- glue::glue("On the {num_word} day of Christmas, my true love sent to me,")

  phrases <- dataset %>% 
      pull({{phrase_col}})

  phrase <- phrases[line:1] %>% 
    str_c(collapse = "\n")
  
    if (line == 1){
    phrase <- str_trim(str_replace(phrase, "one"," "))
  } else{
    phrase <- str_replace(phrase, "one", "and")
  }

  
  return(glue::glue("{intro} \n{phrase}"))
}

```

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 10px;}
</style>
<div class = "blue">

**4** -- Nice `if()`, `else()` for deciding what should be printed for the first line. If you 
would have used `if_else()` your function would be vectorized! 

</div>


### Test sing_line()

```{r}

sing_line(xmas, 
          line = 2, 
          phrase_col = Full.Phrase)

```

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 10px;}
</style>
<div class = "blue">

**4** -- Nice check! 

</div>


---

## Step Four: Use Your Functions!

```{r}
xmas2 <- xmas %>%
  mutate(
    day.num = as.character(english::english(Day)), 
    Full.Phrase = pmap_chr(list(num = Day, 
                                num_word = day.num, 
                                item = Gift.Item, 
                                verb = Verb, 
                                adjective = Adjective, 
                                location = Location), 
                           make_phrase)
  )

map_chr(1:12, ~sing_line(xmas2, .x, Full.Phrase)) %>%
  str_c(collapse = "\n") %>%
  cat()

```

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 10px;}
</style>
<div class = "blue">

**4** -- Nice work!

</div>

## Step Five: Show Me Your Work! 

GitHub repository link: https://github.com/smcalloway/twelvedays


<br><br><br><br>


